<div id="emoji-picker-container"
    class="fixed top-20 right-6 z-[9999] hidden animate-in fade-in slide-in-from-top-4 duration-300">
    <div class="glass-card !p-0 w-80 shadow-2xl border-white/10 overflow-hidden">
        <!-- Header / Search -->
        <div class="p-4 border-b border-white/5 bg-white/5">
            <div class="flex items-center justify-between mb-4">
                <h3
                    class="text-[10px] font-black text-p-title uppercase tracking-widest italic flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-primary animate-pulse"></span>
                    Emoji Universe
                </h3>
                <button onclick="toggleEmojiPicker()" class="text-p-muted hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="relative">
                <input type="text" id="emoji-search" placeholder="Buscar emoji..."
                    class="form-input !py-2 !px-8 text-xs !bg-black/20" oninput="filterEmojis(this.value)">
                <svg class="w-3.5 h-3.5 absolute left-2.5 top-1/2 -translate-y-1/2 text-p-muted" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>

        <!-- Categories Nav -->
        <div class="flex items-center gap-1 p-2 bg-black/20 border-b border-white/5 overflow-x-auto no-scrollbar">
            <button onclick="scrollToEmojiCategory('faces')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all" title="Caras">ğŸ˜€</button>
            <button onclick="scrollToEmojiCategory('nature')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all"
                title="Naturaleza">ğŸŒ¿</button>
            <button onclick="scrollToEmojiCategory('food')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all" title="Comida">ğŸ</button>
            <button onclick="scrollToEmojiCategory('activities')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all"
                title="Actividades">âš½</button>
            <button onclick="scrollToEmojiCategory('travel')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all" title="Viajes">âœˆï¸</button>
            <button onclick="scrollToEmojiCategory('objects')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all" title="Objetos">ğŸ’¡</button>
            <button onclick="scrollToEmojiCategory('symbols')"
                class="emoji-cat-btn p-2 hover:bg-white/5 rounded-lg text-lg transition-all"
                title="SÃ­mbolos">â¤ï¸</button>
        </div>

        <!-- Emoji Grid -->
        <div id="emoji-grid" class="h-64 overflow-y-auto p-4 grid grid-cols-6 gap-2 custom-scrollbar scroll-smooth">
            <!-- Content generated by JS -->
        </div>

        <!-- Preview Footer -->
        <div id="emoji-preview"
            class="p-3 bg-white/5 border-t border-white/5 flex items-center gap-3 text-p-muted italic text-[10px]">
            Selecciona un emoji para insertar
        </div>
    </div>
</div>

<script>
    const EMOJI_DATA = {
        faces: { label: 'Caras', emojis: ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’', 'ğŸ˜', 'ğŸ˜”', 'ğŸ˜Ÿ', 'ğŸ˜•', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜£', 'ğŸ˜–', 'ğŸ˜«', 'ğŸ˜©', 'ğŸ¥º', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¤', 'ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ¤¯', 'ğŸ˜³', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜±', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜“', 'ğŸ¤—', 'ğŸ¤”', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤¤', 'ğŸ˜ª', 'ğŸ˜µ', 'ğŸ¤', 'ğŸ¥´', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶'] },
        nature: { label: 'Naturaleza', emojis: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ»â€â„ï¸', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ', 'ğŸœ', 'ğŸ¦Ÿ', 'ğŸ¦—', 'ğŸ•·', 'ğŸ•¸', 'ğŸ¦‚', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦€', 'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦', 'ğŸ¦§', 'ğŸ˜', 'ğŸ¦›', 'ğŸ¦', 'ğŸª', 'ğŸ«', 'ğŸ¦’', 'ğŸ¦˜', 'ğŸ¦¬', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ', 'ğŸ–', 'ğŸ', 'ğŸ‘', 'ğŸ', 'ğŸ¦Œ', 'ğŸ•', 'ğŸ©', 'ğŸ¦®', 'ğŸ•â€ğŸ¦º', 'ğŸˆ', 'ğŸˆâ€â¬›', 'ğŸ“', 'ğŸ¦ƒ', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦¢', 'ğŸ¦©', 'ğŸ•Š', 'ğŸ‡', 'ğŸ¦', 'ğŸ¦¨', 'ğŸ¦¡', 'ğŸ¦«', 'ğŸ¦¦', 'ğŸ¦¥', 'ğŸ', 'ğŸ€', 'ğŸ¿', 'ğŸ¦”', 'ğŸŒµ', 'ğŸ„', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒ±', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€', 'ğŸ', 'ğŸ‹', 'ğŸƒ', 'ğŸ‚', 'ğŸ', 'ğŸ„', 'ğŸŒ¾', 'ğŸ’', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ¥€', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ›', 'ğŸŒœ', 'ğŸŒš', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜', 'ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ™', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸª', 'ğŸ’«', 'â­ï¸', 'ğŸŒŸ', 'âœ¨', 'âš¡ï¸', 'â˜„ï¸', 'ğŸ’¥', 'ğŸ”¥', 'ğŸŒª', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ¤', 'â›…ï¸', 'ğŸŒ¥', 'â˜ï¸', 'ğŸŒ¦', 'ğŸŒ§', 'â›ˆ', 'ğŸŒ©', 'ğŸŒ¨', 'â„ï¸', 'â˜ƒï¸', 'â›„ï¸', 'ğŸŒ¬', 'ğŸ’¨', 'ğŸ’§', 'ğŸ’¦', 'â˜”ï¸'] },
        food: { label: 'Comida', emojis: ['ğŸ', 'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', ' melon', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ¶', 'ğŸ˜¾', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ«’', 'ğŸ§„', 'ğŸ§…', 'ğŸ¥”', 'ğŸ ', 'ğŸ¥', 'ğŸ¥¯', 'ğŸ', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ§€', 'ğŸ¥š', 'ğŸ³', 'ğŸ§ˆ', 'ğŸ¥', 'ğŸ§‡', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸ¦´', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ«“', 'ğŸ¥ª', 'ğŸ¥™', 'ğŸ§†', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ«•', 'ğŸ¥£', 'ğŸ', 'ğŸœ', 'ğŸ²', 'ğŸ›', 'ğŸ£', 'ğŸ±', 'ğŸ¥Ÿ', 'ğŸ¦ª', 'ğŸ¤', 'ğŸ™', 'ğŸš', 'ğŸ˜', 'ğŸ¥', 'ğŸ¥ ', 'ğŸ¥®', 'ğŸ¢', 'ğŸ¡', 'ğŸ§', 'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ§', 'ğŸ°', 'ğŸ‚', 'ğŸ®', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸŒ°', 'ğŸ¥œ', 'ğŸ¯', 'ğŸ¥›', 'â˜•ï¸', 'ğŸ«–', 'ğŸµ', 'ğŸ¶', 'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ·', 'ğŸ¥ƒ', 'ğŸ¸', 'ğŸ¹', 'ğŸ§‰', 'ğŸ¾', 'ğŸ§Š', 'ğŸ¥¤', 'ğŸ§‹'] },
        activities: { label: 'Actividades', emojis: ['âš½ï¸', 'ğŸ€', 'ğŸˆ', 'âš¾ï¸', 'ğŸ¥', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ¥', 'ğŸ±', 'ğŸª€', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ‘', 'ğŸ¥', 'ğŸ', 'ğŸªƒ', 'ğŸ¥…', 'â›³ï¸', 'ğŸª', 'ğŸ¹', 'ğŸ£', 'ğŸ¤¿', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ½', 'ğŸ›¹', 'ğŸ›¼', 'ğŸ›·', 'â›¸', 'ğŸ¥Œ', 'ğŸ¿', 'â›·', 'ğŸ‚', 'ğŸ‹ï¸â€â™€ï¸', 'ğŸ¤¼â€â™‚ï¸', 'ğŸ¤¸â€â™€ï¸', 'â›¹ï¸â€â™‚ï¸', 'ğŸ¤º', 'ğŸ¤¾â€â™‚ï¸', 'ğŸŒï¸â€â™‚ï¸', 'ğŸ‡', 'ğŸ§˜â€â™€ï¸', 'ğŸ„â€â™‚ï¸', 'ğŸŠâ€â™‚ï¸', 'ğŸ¤½â€â™‚ï¸', 'ğŸš£â€â™‚ï¸', 'ğŸ§—â€â™‚ï¸', 'ğŸšµâ€â™‚ï¸', 'ğŸš´â€â™‚ï¸', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ–', 'ğŸµ', 'ğŸ«', 'ğŸŸ', 'ğŸ­', 'ğŸ¨', 'ğŸ–¼', 'ğŸ§µ', 'ğŸª¡', 'ğŸ§¶', 'ğŸ¸', 'ğŸ»', 'ğŸ·', 'ğŸº', 'ğŸ¸', 'ğŸ¥', 'ğŸª˜'] },
        travel: { label: 'Viajes', emojis: ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸ', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'ğŸ›»', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸ', 'ğŸ›µ', 'ğŸ¦½', 'ğŸ¦¼', 'ğŸ›º', 'ğŸš²', 'ğŸ›¹', 'ğŸ›´', 'âš“ï¸', 'â›µï¸', 'ğŸ›¶', 'ğŸš¤', 'ğŸ›³', 'â›´', 'ğŸš¢', 'âœˆï¸', 'ğŸ›©', 'ğŸ›«', 'ğŸ›¬', 'ğŸª‚', 'ğŸ’º', 'ğŸš', 'ğŸšŸ', 'ğŸš ', 'ğŸš¡', 'ğŸ›°', 'ğŸš€', 'ğŸ›¸', 'ğŸ›¸', 'ğŸ›', 'ğŸ§³', 'âŒ›ï¸', 'â³', 'âŒšï¸', 'â°', 'â±', 'â²', 'ğŸ•°', 'ğŸŒ¡', 'â˜€ï¸', 'ğŸŒ¤', 'â›…ï¸', 'ğŸŒ¥', 'â˜ï¸', 'ğŸŒ¦', 'ğŸŒ§', 'â›ˆ', 'ğŸŒ©', 'ğŸŒ¨', 'â„ï¸', 'â˜ƒï¸', 'â›„ï¸'] },
        objects: { label: 'Objetos', emojis: ['âŒšï¸', 'ğŸ“±', 'ğŸ“²', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–±', 'ğŸ–¨', 'ğŸ–¥', 'ğŸ–±', 'ğŸ–²', 'ğŸ•¹', 'ğŸ—œ', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“¼', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“½', 'ğŸ', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“º', 'ğŸ“»', 'ğŸ™', 'ğŸš', 'ğŸ›', 'ğŸ§­', 'â±', 'â²', 'â°', 'ğŸ•°', 'âŒ›ï¸', 'â³', 'ğŸ“¡', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯', 'ğŸª”', 'ğŸ§¯', 'ğŸ›¢', 'ğŸ’¸', 'ğŸ’µ', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸª™', 'ğŸ’°', 'ğŸ’³', 'ğŸ’', 'âš–ï¸', 'ğŸªœ', 'ğŸ§°', 'ğŸª›', 'ğŸ”§', 'ğŸ”¨', 'âš’', 'ğŸ› ', 'â›', 'ğŸªš', 'ğŸ”«', 'ğŸ’£', 'ğŸ§¨', 'ğŸª“', 'ğŸ”ª', 'ğŸ—¡', 'âš”ï¸', 'ğŸ›¡', 'ğŸš¬', 'âš°ï¸', 'ğŸª¦', 'âš±ï¸', 'ğŸº', 'ğŸ”®', 'ğŸ“¿', 'ğŸ§¿', 'ğŸ’ˆ', 'âš—ï¸', 'ğŸ”­', 'ğŸ”¬', 'ğŸ•³', 'ğŸ©¹', 'ğŸ©º', 'ğŸ’Š', 'ğŸ’‰', 'ğŸ©¸', 'ğŸ§¬', 'ğŸ¦ ', 'ğŸ§«', 'ğŸ§ª', 'ğŸŒ¡', 'ğŸ§¹', 'ğŸ§º', 'ğŸ§»', 'ğŸš½', 'ğŸš°', 'ğŸš¿', 'ğŸ›', 'ğŸ›€', 'ğŸ§¼', 'ğŸª¥', 'ğŸª’', 'ğŸ§½', 'ğŸª£', 'ğŸ§´', 'ğŸ›', 'ğŸ”‘', 'ğŸ—', 'ğŸšª', 'ğŸª‘', 'ğŸ›‹', 'ğŸ›Œ', 'ğŸ›', 'ğŸ§¸', 'ğŸª†', 'ğŸ–¼', 'ğŸª', 'ğŸ§º', 'ğŸ§¹', 'ğŸ§¹', 'ğŸ§´'] },
        symbols: { label: 'SÃ­mbolos', emojis: ['â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ğŸ•‰', 'â˜¸ï¸', 'âœ¡ï¸', 'ğŸ”¯', 'ğŸ•', 'â˜¯ï¸', 'â˜¦ï¸', 'ğŸ›', 'â›', 'â™ˆï¸', 'â™‰ï¸', 'â™Šï¸', 'â™‹ï¸', 'â™Œï¸', 'â™ï¸', 'â™ï¸', 'â™ï¸', 'â™ï¸', 'â™‘ï¸', 'â™’ï¸', 'â™“ï¸', 'ğŸ†”', 'âš›ï¸', 'ğŸ‰‘', 'â˜¢ï¸', 'â˜£ï¸', 'ğŸ“´', 'ğŸ“³', 'ğŸˆ¶', 'ğŸˆšï¸', 'ğŸˆ¸', 'ğŸˆº', 'ğŸˆ·ï¸', 'âœ´ï¸', 'ğŸ†š', 'ğŸ’®', 'ğŸ‰', 'ãŠ™ï¸', 'ãŠ—ï¸', 'ğŸˆ´', 'ğŸˆµ', 'ğŸˆ¹', 'ğŸˆ²', 'ğŸ…°ï¸', 'ğŸ…±ï¸', 'ğŸ†', 'ğŸ†‘', 'ğŸ…¾ï¸', 'ğŸ†˜', 'âŒ', 'â­•ï¸', 'ğŸ›‘', 'â›”ï¸', 'ğŸ“›', 'ğŸš«', 'ğŸ’¯', 'ğŸ’¢', 'â™¨ï¸', 'ğŸš·', 'ğŸš¯', 'ğŸš³', 'ğŸš±', 'ğŸ”', 'ğŸ“µ', 'ğŸš­', 'â—', 'â•', 'â“', 'â”', 'â€¼ï¸', 'â‰ï¸', 'ğŸ”…', 'ğŸ”†', 'ã€½ï¸', 'âš ï¸', 'ğŸš¸', 'ğŸ”°', 'â™»ï¸', 'ğŸˆ¯ï¸', 'ğŸ’¹', 'â‡ï¸', 'âœ³ï¸', 'â', 'âœ…', 'ğŸ’ ', 'ğŸŒ€', 'â¿', 'ğŸŒ', 'â“‚ï¸', 'ğŸ§', 'ğŸˆ‚ï¸', 'ğŸ›‚', 'ğŸ›ƒ', 'ğŸ›„', 'ğŸ›…', 'â™¿ï¸', 'ğŸš­', 'ğŸš¾', 'ğŸ…¿ï¸', 'ğŸš°', 'ğŸš¹', 'ğŸšº', 'ğŸš¼', 'ğŸš»', 'ğŸš®', 'ğŸ¦', 'ğŸ“¶', 'ğŸˆ', 'ğŸ”£', 'â„¹ï¸', 'ğŸ”¤', 'ğŸ”¡', 'ğŸ” ', 'ğŸ†–', 'ğŸ†—', 'ğŸ†™', 'ğŸ†’', 'ğŸ†•', 'ğŸ†“', '0ï¸', '1ï¸', '2ï¸', '3ï¸', '4ï¸', '5ï¸', '6ï¸', '7ï¸', '8ï¸', '9ï¸', 'ğŸ”Ÿ', 'ğŸ”¢', '#ï¸', '*ï¸', 'âï¸', 'â–¶ï¸', 'â¸', 'â¯', 'â¹', 'âº', 'â­', 'â®', 'â©', 'âª', 'â«', 'â¬', 'â—€ï¸', 'ğŸ”¼', 'ğŸ”½', 'â¡ï¸', 'â¬…ï¸', 'â¬†ï¸', 'â¬‡ï¸', 'â†—ï¸', 'â†˜ï¸', 'â†™ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†ªï¸', 'â†©ï¸', 'â¤´ï¸', 'â¤µï¸', 'ğŸ”€', 'ğŸ”', 'ğŸ”‚', 'ğŸ”„', 'ğŸ”ƒ', 'ğŸµ', 'ğŸ¶', 'â•', 'â–', 'â—', 'âœ–ï¸', 'â™¾', 'ğŸ’²', 'ğŸ’±', 'â„¢ï¸', 'Â©ï¸', 'Â®ï¸', 'ğŸ‘â€ğŸ—¨', 'ğŸ”š', 'ğŸ”™', 'ON!', 'TOP', 'SOON', 'ğŸ”œ', 'ğŸ†•', 'ğŸ†™', 'ğŸ†—', 'ğŸ†’', 'ğŸ†“'] }
    };

    let lastFocusedElement = null;

    function initEmojiPicker() {
        const grid = document.getElementById('emoji-grid');
        grid.innerHTML = '';

        for (const cat in EMOJI_DATA) {
            const category = EMOJI_DATA[cat];

            // Category Header in Grid
            const header = document.createElement('div');
            header.id = 'cat-anchor-' + cat;
            header.className = 'col-span-6 text-[9px] font-black text-p-muted uppercase tracking-widest mt-4 mb-2 border-b border-white/5 pb-1';
            header.innerText = category.label;
            grid.appendChild(header);

            // Emojis
            category.emojis.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'text-xl p-1 hover:bg-white/10 rounded-lg transition-all transform hover:scale-125';
                btn.innerText = emoji;
                btn.onclick = () => insertEmoji(emoji);
                btn.onmouseenter = () => {
                    document.getElementById('emoji-preview').innerText = `Emoji: ${emoji}`;
                };
                grid.appendChild(btn);
            });
        }

        // Global click listener to detect last focused input
        document.addEventListener('focusin', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                lastFocusedElement = e.target;
            }
        });
    }

    function toggleEmojiPicker() {
        const picker = document.getElementById('emoji-picker-container');
        const isHidden = picker.classList.contains('hidden');

        if (isHidden) {
            picker.classList.remove('hidden');
            document.getElementById('emoji-search').focus();
        } else {
            picker.classList.add('hidden');
        }
    }

    function scrollToEmojiCategory(cat) {
        const el = document.getElementById('cat-anchor-' + cat);
        if (el) {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    function filterEmojis(query) {
        const grid = document.getElementById('emoji-grid');
        const btns = grid.getElementsByTagName('button');
        const headers = grid.getElementsByTagName('div');

        if (!query) {
            for (let b of btns) b.style.display = 'block';
            for (let h of headers) h.style.display = 'block';
            return;
        }

        // In a real scenario we'd need names, for now we just show all if searching
        // but hide category headers to make it a flat list
        for (let h of headers) h.style.display = 'none';
        // (Simple filtering logic would go here if we had metadata)
    }

    function insertEmoji(emoji) {
        if (!lastFocusedElement) {
            // If no focus, try to find the first visible input in a form
            lastFocusedElement = document.querySelector('input:not([type="hidden"]), textarea');
        }

        if (lastFocusedElement) {
            const start = lastFocusedElement.selectionStart;
            const end = lastFocusedElement.selectionEnd;
            const text = lastFocusedElement.value;
            const before = text.substring(0, start);
            const after = text.substring(end, text.length);

            lastFocusedElement.value = before + emoji + after;
            lastFocusedElement.selectionStart = lastFocusedElement.selectionEnd = start + emoji.length;
            lastFocusedElement.focus();

            // Trigger input event for frameworks/listeners
            lastFocusedElement.dispatchEvent(new Event('input', { bubbles: true }));
        }
    }

    // Shortcut Ctrl+E
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'e') {
            e.preventDefault();
            toggleEmojiPicker();
        }
    });

    document.addEventListener('DOMContentLoaded', initEmojiPicker);
</script>

<style>
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(var(--primary-rgb), 0.5);
    }
</style>